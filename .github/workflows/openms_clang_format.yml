# Action to allow clang format linting at the files changed in the PR

name: openms_clang_format

on:
   push:
     branches:
     - develop
     - add/openms_clang_format
   pull_request:
     branches:
     - develop
     - add/openms_clang_format

jobs:

# Checkout OpenMS
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
      with:
        path: OpenMS

# Get files changed in the PR
# and correct path information for linting
    - id: files
      uses: jitterbit/get-changed-files@v1
      - run: |
            for changed_file in ${{ steps.files.outputs.all }}; do
              echo "Do something with this ${changed_file}."
              append_path='./OpenMS/src${changed_file}'
              echo $append path
              files+=${changed_file}
            done
            echo $files

# Perform linting
    - name: Use clang format linting
      uses: DoozyX/clang-format-lint-action@v0.12
      with:
        source: $files
        extensions: 'h,cpp'
        clangFormatVersion: 12
        style: LLVM
